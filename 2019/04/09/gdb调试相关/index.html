<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>gdb调试相关 › Hao Yu&#39;s blog</title>
  <meta name="author" content="Hao Yu">
  
  <meta name="description" content="Introduce something interesting">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="gdb调试相关">
  <meta property="og:site_name" content="Hao Yu&#39;s blog">

  
    <meta property="og:image" content>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Hao Yu&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>
</html>

<body>
  <header id="header"><div class="meta inner">
  <h1><a href="/">Hao Yu&#39;s blog</a></h1>
  <h2><a href="/">The program monkey was eaten by the siege lion.</a></h2>
  <nav id="main-nav">
    <ul>
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about">About</a></li>
      
      <li><a href="/archives">Archives</a></li>
      
      <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title">gdb调试相关</h1>
  

      
        <time datetime="2019-04-09T04:47:34.000Z">2019-04-09</time>
      
    </header>
    <div class="entry">
      
        <p>给师兄debug测试的时候深深觉得自己太垃圾了，gdb用的不熟，所以去找了一篇gdb的博文搬过来整理好，纯当复习了。<br>贴原文链接：<a href="https://blog.csdn.net/zb872676223/article/details/37906049" target="_blank" rel="noopener">https://blog.csdn.net/zb872676223/article/details/37906049</a></p>
<h1 id="测试程序"><a href="#测试程序" class="headerlink" title="测试程序"></a>测试程序</h1><p>我们先看看我们的测试程序:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">/* in eg1.c */</span><br><span class="line">int wib(int no1, int no2)</span><br><span class="line">&#123;</span><br><span class="line">    int result, diff;</span><br><span class="line">    diff = no1 - no2;</span><br><span class="line">    result = no1 / diff;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    pid_t pid;</span><br><span class="line"></span><br><span class="line">    pid = fork();</span><br><span class="line">    if (pid &lt;0) &#123;</span><br><span class="line">        printf(&quot;fork err\n&quot;);</span><br><span class="line">        exit(-1);</span><br><span class="line">    &#125; else if (pid == 0) &#123;</span><br><span class="line">        /* in child process */</span><br><span class="line">        sleep(60); ------------------ (!)</span><br><span class="line"></span><br><span class="line">        int value = 10;</span><br><span class="line">        int div = 6;</span><br><span class="line">        int total = 0;</span><br><span class="line">        int i     = 0;</span><br><span class="line">        int result = 0;</span><br><span class="line"></span><br><span class="line">        for (i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">                result = wib(value, div);</span><br><span class="line">                total += result;</span><br><span class="line">                div++;</span><br><span class="line">                value--;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;%d wibed by %d equals %d\n&quot;, value, div, total);</span><br><span class="line">        exit(0);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">         /* in parent process */</span><br><span class="line">         sleep(4);</span><br><span class="line">         wait(-1);</span><br><span class="line">         exit(0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>该测试程序中子进程运行过程中会在wib函数中出现一个’除0’异常。现在我们就要调试该子进程。</p>
<h1 id="调试原理"><a href="#调试原理" class="headerlink" title="调试原理"></a>调试原理</h1><p>不知道大家发现没有，在(!)处在我们的测试程序在父进程fork后，子进程调用sleep睡了60秒。这就是关键，这个sleep本来是不该存在于子进程代码中的，而是而了使用GDB调试后加入的，它是我们调试的一个关键点。为什么要让子进程刚刚运行就开始sleep呢？因为我们要在子进程睡眠期间，利用 shell命令获取其process id，然后再利用gdb调试外部进程的方法attach到该process id上，调试该进程。<br>我们现在调试的是mpi程序，intel的mpiexec可以直接-gdb进行调试，但是用gnu的话就不行了，只能gdb attach来调试，下述。</p>
<h1 id="调试过程"><a href="#调试过程" class="headerlink" title="调试过程"></a>调试过程</h1><p>GDB 调试程序的前提条件就是你编译程序时必须加入调试符号信息，即使用’-g’编译选项。首先编译我们的源程序<code>gcc -g -o eg1 eg1.c</code>。编译好之后，我们就有了我们的调试目标eg1。由于我们在调试过程中需要多个工具配合，所以你最好多打开几个终端窗口，另外一点需要注意的是最好在eg1的working directory下执行gdb程序，否则gdb回提示’No symbol table is loaded’。你还得手工load symbol table。好了，下面我们就’按部就班’的开始调试我们的eg1。</p>
<p>执行eg1:<code>eg1 &amp;   --- 让eg1后台运行</code></p>
<p>查找进程id:<code>ps -fu YOUR_USER_NAME</code><br>或在linux下使用<code>getpid()</code>函数</p>
<p>运行gdb:<br>gdb<br>(gdb) attach xxxxx — xxxxx为利用ps命令获得的子进程process id<br>(gdb) stop — 这点很重要，你需要先暂停那个子进程，然后设置一些断点和一些Watch<br>(gdb) break 37 – 在result = wib(value, div);这行设置一个断点,可以使用list命令察看源代码<br>Breakpoint 1 at 0x10808: file eg1.c, line 37.<br>(gdb) continue<br>Continuing.<br>这里一定要continue，要不的话。。。。。。傻呼呼的等那么久还不运行。</p>
<p>Breakpoint 1, main () at eg1.c:37<br>37                              result = wib(value, div);<br>(gdb) step<br>wib (no1=10, no2=6) at eg1.c:13<br>13              diff = no1 - no2;<br>(gdb) continue<br>Continuing.</p>
<p>Breakpoint 1, main () at eg1.c:37<br>37                              result = wib(value, div);<br>(gdb) step<br>wib (no1=9, no2=7) at eg1.c:13<br>13              diff = no1 - no2;<br>(gdb) continue<br>Continuing.</p>
<p>Breakpoint 1, main () at eg1.c:37<br>37                              result = wib(value, div);<br>(gdb) step<br>wib (no1=8, no2=8) at eg1.c:13<br>13              diff = no1 - no2;<br>(gdb) next<br>14              result = no1 / diff;<br>(gdb) print diff<br>$6 = 0        ——- 除数为0，我们找到罪魁祸首了。<br>(gdb) next<br>Program received signal SIGFPE, Arithmetic exception.<br>0xff29d830 in .div () from /usr/lib/libc.so.1</p>
<p>至此，我们调试完毕。</p>
<h1 id="GDB调试精粹"><a href="#GDB调试精粹" class="headerlink" title="GDB调试精粹"></a>GDB调试精粹</h1><h2 id="一、列文件清单"><a href="#一、列文件清单" class="headerlink" title="一、列文件清单"></a>一、列文件清单</h2><p>list / l</p>
<p>列出产生执行文件的源代码的一部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//列出 line1 到 line2 行之间的源代码  </span><br><span class="line">(gdb) list line1, line2  </span><br><span class="line">  </span><br><span class="line">//输出从上次调用list命令开始往后的10行程序代码  </span><br><span class="line">(gdb) list  </span><br><span class="line">  </span><br><span class="line">//输出第 n 行附近的10行程序代码  </span><br><span class="line">(gdb) list n  </span><br><span class="line">  </span><br><span class="line">//输出函数function前后的10行程序代码  </span><br><span class="line">(gdb) list function</span><br></pre></td></tr></table></figure>
<h2 id="二、执行程序"><a href="#二、执行程序" class="headerlink" title="二、执行程序"></a>二、执行程序</h2><p><code>run / r</code><br>运行准备调试的程序，在它后面可以跟随发给该程序的任何参数，包括标准输入和标准输出说明符(&lt;和&gt;)和shell通配符（*、？、[、]）在内。<br>如果你使用不带参数的run命令，gdb就再次使用你给予前一条run命令的参数，这是很有用的。</p>
<p><code>set args</code><br>命令就可以修改发送给程序的参数，而使用</p>
<p><code>show args</code><br>命令就可以查看其缺省参数的列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set args –b –x  </span><br><span class="line">(gdb) show args</span><br></pre></td></tr></table></figure>
<h2 id="三、显示数据"><a href="#三、显示数据" class="headerlink" title="三、显示数据"></a>三、显示数据</h2><p>print / p</p>
<p>查看变量的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//利用print 命令可以检查各个变量的值。  </span><br><span class="line">(gdb) print p (p为变量名)  </span><br><span class="line">print 是 gdb 的一个功能很强的命令，利用它可以显示被调试的语言中任何有效的表达式。表达式除了包含你程序中的变量外，还可以包含以下内容：</span><br><span class="line"></span><br><span class="line">//对程序中函数的调用  </span><br><span class="line">(gdb) print find_entry(1, 0)  </span><br><span class="line">  </span><br><span class="line">//数据结构和其他复杂对象  </span><br><span class="line">(gdb) print *table_start  </span><br><span class="line">$8=&#123;e=reference=’\000’,location=0x0,next=0x0&#125;  </span><br><span class="line">  </span><br><span class="line">//值的历史成分  </span><br><span class="line">(gdb)print $1 ($1为历史记录变量,在以后可以直接引用 $1 的值)  </span><br><span class="line">whatis </span><br><span class="line"></span><br><span class="line">查看变量的类型</span><br><span class="line"></span><br><span class="line">//whatis 命令可以显示某个变量的类型  </span><br><span class="line">(gdb) whatis p  </span><br><span class="line">type = int *</span><br></pre></td></tr></table></figure>
<p>四、设置与清除断点</p>
<p><code>break / b</code><br>可以用来在调试的程序中设置断点，该命令有如下四种形式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//使程序恰好在执行给定行之前停止  </span><br><span class="line">break line-number  </span><br><span class="line">  </span><br><span class="line">//使程序恰好在进入指定的函数之前停止  </span><br><span class="line">  </span><br><span class="line">break function-name  </span><br><span class="line">  </span><br><span class="line">//如果condition（条件）是真，程序到达指定行或函数时停止  </span><br><span class="line">break line-or-function if condition  </span><br><span class="line">   </span><br><span class="line">//在指定例程的入口处设置断点  </span><br><span class="line">break routine-name</span><br></pre></td></tr></table></figure></p>
<p>如果该程序是由很多原文件构成的，你可以在各个原文件中设置断点，而不是在当前的原文件中设置断点，其方法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) break filename:line-number  </span><br><span class="line">  </span><br><span class="line">(gdb) break filename:function-name  </span><br><span class="line">break  if</span><br></pre></td></tr></table></figure></p>
<p>要想设置一个条件断点，可以利用break if命令，如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) break line-or-function if expr  </span><br><span class="line">  </span><br><span class="line">(gdb) break 46 if testsize==100  </span><br><span class="line">clean number</span><br></pre></td></tr></table></figure></p>
<p>清除原文件中某一代码行上的所有断点</p>
<p>注：number 为原文件的某个代码行的行号</p>
<h2 id="五、断点的管理"><a href="#五、断点的管理" class="headerlink" title="五、断点的管理"></a>五、断点的管理</h2><ol>
<li><p>显示当前gdb的断点信息<br><code>info break</code></p>
</li>
<li><p>delete 删除指定的某个断点<br><code>delete breakpoint</code></p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//该命令将会删除编号为1的断点  </span><br><span class="line">(gdb) delete breakpoint 1  </span><br><span class="line">  </span><br><span class="line">//如果不带编号参数，将删除所有的断点  </span><br><span class="line">(gdb) delete breakpoint</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>禁止、允许使用某个断点<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">disable breakpoint 1</span><br><span class="line">enable breakpoint 1</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>该命令将禁止、允许断点 1，同时断点信息的 (Enb)域将变为 n、y</p>
<h2 id="六、单步执行"><a href="#六、单步执行" class="headerlink" title="六、单步执行"></a>六、单步执行</h2><p><code>next / n</code><br>不进入的单步执行</p>
<p><code>step</code><br>进入的单步执行</p>
<p><code>finish</code><br>如果已经进入了某函数，而想退出该函数返回到它的调用函数中，可使用命令finish</p>
<p><code>until</code><br>结束当前循环</p>
<h2 id="七、函数的调用"><a href="#七、函数的调用" class="headerlink" title="七、函数的调用"></a>七、函数的调用</h2><p><code>call name</code><br>调用和执行一个函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) call gen_and_sork( 1234,1,0 )  </span><br><span class="line">(gdb) call printf(“abcd”)  </span><br><span class="line">$1=4</span><br></pre></td></tr></table></figure></p>
<h2 id="八、-原文件的搜索"><a href="#八、-原文件的搜索" class="headerlink" title="八、 原文件的搜索"></a>八、 原文件的搜索</h2><p>search text</p>
<p>该命令可显示在当前文件中包含text串的下一行。</p>
<p>reverse-search text</p>
<p>该命令可以显示包含text 的前一行。</p>
<p>小结：常用的 gdb 命令</p>
<p>backtrace / bt 显示程序中的当前位置和表示如何到达当前位置的栈跟踪（同义词：where）</p>
<p>breakpoint / b 在程序中设置一个断点</p>
<p>cd 改变当前工作目录</p>
<p>clear 删除刚才停止处的断点</p>
<p>commands 命中断点时，列出将要执行的命令</p>
<p>continue 从断点开始继续执行</p>
<p>delete 删除一个断点或监测点；也可与其他命令一起使用</p>
<p>display 程序停止时显示变量和表达时</p>
<p>down 下移栈帧，使得另一个函数成为当前函数</p>
<p>frame 选择下一条continue命令的帧</p>
<p>info 显示与该程序有关的各种信息</p>
<p>jump 在源程序中的另一点开始运行</p>
<p>kill 异常终止在gdb 控制下运行的程序</p>
<p>list 列出相应于正在执行的程序的原文件内容</p>
<p>next 执行下一个源程序行，从而执行其整体中的一个函数</p>
<p>print 显示变量或表达式的值</p>
<p>pwd 显示当前工作目录</p>
<p>ptype 显示一个数据结构（如一个结构或C++类）的内容</p>
<p>quit 退出gdb</p>
<p>reverse-search 在源文件中反向搜索正规表达式</p>
<p>run 执行该程序</p>
<p>search 在源文件中搜索正规表达式</p>
<p>set variable 给变量赋值</p>
<p>signal 将一个信号发送到正在运行的进程</p>
<p>step 执行下一个源程序行，必要时进入下一个函数</p>
<p>undisplay display 命令的反命令，不要显示表达式</p>
<p>until 结束当前循环</p>
<p>up 上移栈帧，使另一函数成为当前函数</p>
<p>watch 在程序中设置一个监测点（即数据断点）</p>
<p>whatis 显示变量或函数类型</p>

      
    </div>
      
      <footer>
        
        
  
  <div class="tags">
    <a href="/tags/Linux/">Linux</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>


<section id="comment">
  
</section>


</div></div>
    <aside id="sidebar" class="alignright">
  

  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2019/04/09/gdb调试相关/">gdb调试相关</a>
      </li>
    
      <li>
        <a href="/2019/04/09/由Leetcode807引发的memset问题/">由Leetcode807引发的memset问题</a>
      </li>
    
      <li>
        <a href="/2019/04/09/Leetcode807-Max-Increase-to-Keep-City-Skyline/">Leetcode807. Max Increase to Keep City Skyline</a>
      </li>
    
      <li>
        <a href="/2019/04/09/C-标准库之stack/">C++标准库之stack</a>
      </li>
    
      <li>
        <a href="/2019/04/09/Leetcode1021-Remove-Outermost-Parentheses/">Leetcode1021. Remove Outermost Parentheses</a>
      </li>
    
  </ul>
</div>


  

  
<div class="widget tagcloud">
  <h3 class="title">Tag Cloud</h3>
  <div class="entry">
    <a href="/tags/Leetcode/" style="font-size: 20px;">Leetcode</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/日常/" style="font-size: 10px;">日常</a> <a href="/tags/积累/" style="font-size: 15px;">积累</a>
  </div>
</div>


</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2019 Hao Yu
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



</body>
</html>

